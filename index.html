<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f0f23">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <title>本質チェッカー</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0f0f23;
      --bg-card: #1a1a35;
      --bg-input: #12122a;
      --primary: #7c3aed;
      --primary-glow: rgba(124, 58, 237, 0.4);
      --accent: #06b6d4;
      --accent-glow: rgba(6, 182, 212, 0.3);
      --text: #e2e8f0;
      --text-dim: #94a3b8;
      --text-bright: #f8fafc;
      --border: #2d2d52;
      --radius: 16px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
    }

    /* Background animation */
    .bg-effect {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-effect::before {
      content: '';
      position: absolute;
      width: 600px; height: 600px;
      background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
      top: -200px; right: -200px;
      animation: float1 8s ease-in-out infinite;
    }

    .bg-effect::after {
      content: '';
      position: absolute;
      width: 500px; height: 500px;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
      bottom: -150px; left: -150px;
      animation: float2 10s ease-in-out infinite;
    }

    @keyframes float1 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-50px, 50px); }
    }

    @keyframes float2 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(50px, -30px); }
    }

    /* App container */
    .app {
      position: relative;
      z-index: 1;
      max-width: 480px;
      margin: 0 auto;
      padding: 0 20px;
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 48px 0 24px;
      flex-shrink: 0;
    }

    .header-icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: inline-block;
      animation: pulse-icon 3s ease-in-out infinite;
    }

    @keyframes pulse-icon {
      0%, 100% { transform: scale(1); filter: drop-shadow(0 0 8px var(--primary-glow)); }
      50% { transform: scale(1.08); filter: drop-shadow(0 0 20px var(--primary-glow)); }
    }

    .header h1 {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #c084fc, #7c3aed, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 2px;
    }

    .header p {
      color: var(--text-dim);
      font-size: 14px;
      margin-top: 6px;
    }

    /* Input area */
    .input-area {
      flex-shrink: 0;
      margin-bottom: 24px;
    }

    .input-wrapper {
      position: relative;
      display: flex;
      gap: 10px;
    }

    .input-wrapper input {
      flex: 1;
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 20px;
      font-size: 17px;
      color: var(--text-bright);
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
      font-family: inherit;
    }

    .input-wrapper input::placeholder {
      color: var(--text-dim);
    }

    .input-wrapper input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-glow);
    }

    .btn-check {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      border: none;
      border-radius: var(--radius);
      padding: 16px 24px;
      color: white;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.3s;
      white-space: nowrap;
      font-family: inherit;
    }

    .btn-check:active {
      transform: scale(0.95);
    }

    .btn-check:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Result card */
    .result-area {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 24px;
      -webkit-overflow-scrolling: touch;
    }

    .result-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 24px;
      margin-bottom: 16px;
      animation: card-appear 0.5s cubic-bezier(0.22, 1, 0.36, 1);
      position: relative;
      overflow: hidden;
    }

    .result-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, #7c3aed, #06b6d4);
    }

    @keyframes card-appear {
      from { opacity: 0; transform: translateY(20px) scale(0.97); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .result-word {
      font-size: 13px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 4px;
    }

    .result-input-word {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-bright);
      margin-bottom: 20px;
    }

    .result-label {
      font-size: 12px;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .result-label::before {
      content: '';
      display: inline-block;
      width: 8px; height: 8px;
      background: var(--accent);
      border-radius: 50%;
      animation: dot-pulse 2s ease-in-out infinite;
    }

    @keyframes dot-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .result-essence {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-bright);
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .result-detail {
      font-size: 14px;
      color: var(--text-dim);
      line-height: 1.8;
    }

    .result-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .btn-action {
      flex: 1;
      background: rgba(124, 58, 237, 0.15);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 10px;
      padding: 10px;
      color: #c084fc;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      font-family: inherit;
    }

    .btn-action:active {
      background: rgba(124, 58, 237, 0.3);
    }

    /* Loading animation */
    .loading {
      text-align: center;
      padding: 40px 0;
    }

    .loading-dots {
      display: inline-flex;
      gap: 8px;
    }

    .loading-dots span {
      width: 12px; height: 12px;
      background: var(--primary);
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite;
    }

    .loading-dots span:nth-child(2) { animation-delay: 0.16s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.32s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
      40% { transform: scale(1); opacity: 1; }
    }

    .loading-text {
      color: var(--text-dim);
      font-size: 14px;
      margin-top: 16px;
    }

    /* History section */
    .history-section {
      margin-top: 8px;
    }

    .history-title {
      font-size: 13px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .btn-clear-history {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 12px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      font-family: inherit;
    }

    .btn-clear-history:active {
      background: rgba(255,255,255,0.05);
    }

    .history-item {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .history-item:active {
      background: rgba(124, 58, 237, 0.1);
    }

    .history-item-word {
      font-weight: 700;
      font-size: 15px;
      color: var(--text-bright);
    }

    .history-item-essence {
      font-size: 13px;
      color: var(--text-dim);
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 240px;
    }

    .history-item-arrow {
      color: var(--text-dim);
      font-size: 18px;
      flex-shrink: 0;
      margin-left: 8px;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.6;
    }

    .empty-state-text {
      color: var(--text-dim);
      font-size: 15px;
      line-height: 1.8;
    }

    /* Examples */
    .examples {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 20px;
    }

    .example-chip {
      background: rgba(124, 58, 237, 0.12);
      border: 1px solid rgba(124, 58, 237, 0.25);
      border-radius: 20px;
      padding: 8px 16px;
      color: #c084fc;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s;
      font-family: inherit;
    }

    .example-chip:active {
      background: rgba(124, 58, 237, 0.25);
      transform: scale(0.95);
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 24px;
      color: var(--text);
      font-size: 14px;
      z-index: 1000;
      transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
      white-space: nowrap;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    /* Scrollbar */
    .result-area::-webkit-scrollbar {
      width: 4px;
    }
    .result-area::-webkit-scrollbar-track {
      background: transparent;
    }
    .result-area::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 2px;
    }

    @media (max-width: 360px) {
      .header h1 { font-size: 24px; }
      .result-essence { font-size: 18px; }
      .result-input-word { font-size: 20px; }
    }
  </style>
</head>
<body>
  <div class="bg-effect"></div>

  <div class="app">
    <header class="header">
      <div class="header-icon">&#x1F52E;</div>
      <h1>本質チェッカー</h1>
      <p>言葉の本質を見抜く</p>
    </header>

    <div class="input-area">
      <div class="input-wrapper">
        <input type="text" id="wordInput" placeholder="言葉を入力..." autocomplete="off" enterkeyhint="search">
        <button class="btn-check" id="checkBtn" onclick="checkEssence()">診断</button>
      </div>
    </div>

    <div class="result-area" id="resultArea">
      <div class="empty-state" id="emptyState">
        <div class="empty-state-icon">&#x1F9E0;</div>
        <div class="empty-state-text">
          言葉を入力して<br>その本質を暴きましょう
        </div>
        <div class="examples" id="examples"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ==============================
    // 本質データベース
    // ==============================
    const essenceDB = {
      // 感情・心理
      '愛': {
        essence: '自分の弱さを誰かに預ける勇気',
        detail: '愛とは相手への執着ではなく、自分の不完全さを認めたうえで、それでも誰かとつながろうとする行為。つまり、最も勇敢な自己開示である。'
      },
      '幸せ': {
        essence: '比較をやめた瞬間の心の静けさ',
        detail: '幸せは何かを手に入れた状態ではなく、「もっと」を求めることを一時停止できたときに訪れる。足るを知る、という古い言葉の正体がこれ。'
      },
      '怒り': {
        essence: '期待が裏切られたときの防衛反応',
        detail: '怒りの根底には必ず「こうあるべき」という期待がある。つまり、怒っている人は本当は傷ついている人。怒りは二次感情に過ぎない。'
      },
      '悲しみ': {
        essence: '大切だったものの輪郭を確認する作業',
        detail: '悲しみを感じるということは、そこに確かに大切なものがあった証拠。悲しみの深さは、愛の深さの裏返し。'
      },
      '不安': {
        essence: 'まだ起きていない未来への前払い',
        detail: '不安の96%は実際には起こらないとされる。つまり不安とは、存在しない問題に対する実在する苦痛。脳の過剰な危機管理機能。'
      },
      '嫉妬': {
        essence: '自分が本当に欲しいものを教えてくれるセンサー',
        detail: '嫉妬は醜い感情とされるが、実は最も正直な欲望の表れ。嫉妬の対象を分析すれば、自分が本当に求めているものが見える。'
      },
      '孤独': {
        essence: '自分自身と向き合うための強制ログアウト',
        detail: '孤独は不幸ではなく、社会的ノイズから離れて自分の内面と対話する貴重な時間。偉大な創造はたいてい孤独から生まれる。'
      },
      '優しさ': {
        essence: '痛みを知った人だけが持てる想像力',
        detail: '本当の優しさは性格ではなく能力。自分が傷ついた経験があるからこそ、他人の痛みを想像できる。優しさとは共感の実践。'
      },
      '勇気': {
        essence: '恐怖を感じたまま一歩踏み出すこと',
        detail: '勇気とは恐怖がない状態ではない。怖いと感じながらも行動を選ぶこと。恐怖のない行動は勇気ではなく、ただの無知。'
      },
      '希望': {
        essence: 'まだ見ぬ可能性に賭ける非合理な選択',
        detail: '合理的に考えれば諦めるべき状況でも「それでも」と思えること。希望は根拠のない楽観ではなく、意志の力で未来を信じる行為。'
      },
      '自信': {
        essence: '失敗しても大丈夫だと思える安心感',
        detail: '自信とは「必ず成功する」という確信ではなく、「失敗しても自分は立ち直れる」という信頼。自信の本体は成功体験ではなく回復体験。'
      },
      'プライド': {
        essence: '他人の評価で自分の価値を測る習慣',
        detail: 'プライドが高い人ほど実は自己評価が不安定。本当に自分に自信がある人はプライドを必要としない。プライドは鎧であり、脆さの証。'
      },

      // 社会・仕事
      '仕事': {
        essence: '他人の問題を解決して対価を得る仕組み',
        detail: 'どんな仕事も突き詰めれば「誰かの困りごとを解消すること」に行き着く。報酬は解決した問題の大きさと希少性に比例する。'
      },
      'お金': {
        essence: '信用を数値化したもの',
        detail: 'お金そのものには価値はない。「みんながこれに価値があると信じている」という共同幻想。つまりお金とは、社会全体の信頼のスコアボード。'
      },
      '成功': {
        essence: '自分で定義しない限り永遠に手に入らないもの',
        detail: '成功の定義を他人や社会に委ねると、ゴールは常に移動し続ける。成功とは状態ではなく、自分なりの基準を持てたかどうか。'
      },
      '努力': {
        essence: '正しい方向に向けた時間の投資',
        detail: '努力は美徳とされるが、方向を間違えた努力は消耗でしかない。本質的な努力とは「何をやるか」の選択と「やり続ける」の実行のセット。'
      },
      '才能': {
        essence: '努力を努力と感じない相性の良さ',
        detail: '才能がある分野では、他人が苦痛に感じる反復を自然にこなせる。天才とは、自分にとっての「遊び」がたまたま社会に価値を提供できた人。'
      },
      '教育': {
        essence: '答えの教え方ではなく、問いの立て方を伝えること',
        detail: '知識を詰め込むのは教育の表面。本質は「自分で考える力」を育てること。良い教育者は答えを与えず、良い問いを投げかける。'
      },
      '政治': {
        essence: '限られた資源を誰にどう配るかの意思決定',
        detail: '政治とは理想論ではなく、現実の制約の中でのトレードオフの連続。全員が満足する答えは存在しないという前提から始まる。'
      },
      '自由': {
        essence: '選択の結果を自分で引き受ける覚悟',
        detail: '自由とは「何でもできる」ことではなく、「選んだ結果の責任を取る」こと。責任なき自由はただのわがまま。'
      },
      '正義': {
        essence: '立場が変われば形が変わる相対的な信念',
        detail: '正義は絶対的なものではなく、視点によって変わる。すべての戦争は双方が「正義」を掲げて行われてきた。'
      },
      'SNS': {
        essence: '承認欲求を効率的に満たすための装置',
        detail: 'SNSの本質は情報共有ではなく、「いいね」という形の承認を最も手軽に得られるシステム。人間の承認欲求をハックしたビジネスモデル。'
      },
      '常識': {
        essence: '多数派の思い込みに付けられた権威ある名前',
        detail: '常識は時代や文化で変わる。50年前の常識は今の非常識。常識とは「今この場所で多くの人がそう思っている」以上の意味はない。'
      },

      // 人間関係
      '友情': {
        essence: '利害関係なしに時間を共有できる信頼',
        detail: '友情の本質は「一緒にいて得をするから」ではなく「一緒にいて心地よいから」。損得を超えた関係性こそが友情の証。'
      },
      '結婚': {
        essence: '「この人の問題も引き受ける」という契約',
        detail: '結婚はロマンスの延長ではなく、相手の欠点・問題・面倒も含めて人生を共有するという現実的な決断。覚悟の儀式。'
      },
      '家族': {
        essence: '選べないからこそ鍛えられる人間関係の原型',
        detail: '家族は最初の社会。選べない関係の中で、忍耐・愛情・葛藤・許しを学ぶ。家族関係のパターンは、その後のすべての人間関係に影響する。'
      },
      '信頼': {
        essence: '裏切られるリスクを承知で相手に委ねること',
        detail: '信頼とは「絶対に裏切らない」という確信ではなく、裏切られる可能性を受け入れたうえでの選択。だからこそ価値がある。'
      },
      'コミュニケーション': {
        essence: '自分の世界と相手の世界のすり合わせ',
        detail: '人はそれぞれ異なる前提・経験・感情を持っている。コミュニケーションとは情報伝達ではなく、異なる主観世界間の翻訳作業。'
      },

      // テクノロジー
      'AI': {
        essence: 'パターン認識を極限まで高速化した計算',
        detail: 'AIは「考えている」のではなく、膨大なデータからパターンを見つけて再現している。知性の模倣であり、知性そのものではない（今のところ）。'
      },
      '人工知能': {
        essence: '人間の知的作業を模倣する統計マシン',
        detail: '「知能」という名前がついているが、理解や意識があるわけではない。大量のデータから確率的に最も適切な出力を選んでいるだけ。'
      },
      'インターネット': {
        essence: '人類の集合知と集合愚を同時に実現した発明',
        detail: '情報へのアクセスを民主化した一方で、デマや分断も加速させた。インターネットは道具であり、使う人間の本質を増幅する鏡。'
      },
      'スマホ': {
        essence: '人間の能力を拡張する外付け脳',
        detail: '記憶・計算・通信・ナビゲーション…かつて人間が頭でやっていたことの多くをスマホが代行している。便利だが、依存すると自力が衰える。'
      },
      'プログラミング': {
        essence: '曖昧な要望を厳密な手順に翻訳する技術',
        detail: 'プログラミングの難しさはコードを書くことではなく、人間の曖昧な「こうしたい」を機械が理解できる正確な指示に変換すること。'
      },

      // 生活
      'ダイエット': {
        essence: '食欲という本能と理性の終わりなき交渉',
        detail: '数万年かけて「食べられるときに食べろ」と最適化された本能に、理性で抵抗する行為。だから難しくて当然。根性の問題ではない。'
      },
      '料理': {
        essence: '素材の可能性を引き出す変換作業',
        detail: '料理は「食べられるものを作る」以上に、素材が持つポテンシャルを熱・調味・組み合わせで最大化する創造行為。'
      },
      '睡眠': {
        essence: '脳のメンテナンスとデータ整理の時間',
        detail: '睡眠中に脳は記憶の整理・不要情報の削除・細胞の修復を行っている。寝ることは怠けではなく、最も生産的な行為の一つ。'
      },
      '旅行': {
        essence: '日常の座標系をリセットする体験',
        detail: '旅行の価値は観光地を見ることではなく、普段の環境から離れることで「当たり前」を再発見すること。帰ってきた時に見える景色が変わる。'
      },
      '読書': {
        essence: '他人の人生を低コストで追体験するシミュレーター',
        detail: '一冊の本は著者が何年もかけて得た知見の圧縮ファイル。読書はそれを数時間で解凍して自分の経験に統合できる、最もコスパの良い学習法。'
      },
      '音楽': {
        essence: '言語化できない感情を振動で伝える手段',
        detail: '言葉では表現しきれない感情を、音の振動パターンで直接心に届ける。音楽が国境を超えるのは、言語を介さないから。'
      },

      // 抽象概念
      '時間': {
        essence: '変化を認識するための人間の発明',
        detail: '時間そのものが存在するのではなく、物事が変化することを人間が「時間が流れている」と解釈している。時計は変化の速度を測る道具。'
      },
      '人生': {
        essence: '意味を自分で書き込む白紙のノート',
        detail: '人生にあらかじめ用意された意味はない。だからこそ自分で意味を作れる。これは絶望ではなく、究極の自由。'
      },
      '死': {
        essence: '人生に締め切りを与えることで価値を生む仕組み',
        detail: '永遠に生きられるなら、今日やる理由はなくなる。死があるからこそ時間に限りがあり、限りがあるからこそ選択に重みが生まれる。'
      },
      '運': {
        essence: '準備と機会が交差した瞬間の別名',
        detail: '運が良い人は、チャンスが来る前に準備を終えている人。運とは偶然ではなく、準備×認識力×行動力の掛け算。'
      },
      '夢': {
        essence: '現状の自分と理想の自分との距離',
        detail: '夢を語ることは簡単だが、その距離を埋める行動を続けることが難しい。夢は目的地ではなく、方向を示すコンパス。'
      },
      '真実': {
        essence: '誰も完全には把握できない全体像の断片',
        detail: '人はそれぞれの立場から真実の一部だけを見ている。「自分が見ている真実が全てだ」と思った瞬間、真実から遠ざかる。'
      },
      '美': {
        essence: '脳が「生存に有利」と判断したパターンへの快感',
        detail: '左右対称・黄金比・調和…美しいと感じるものの多くは、進化的に有利な特徴と相関している。美意識は生存本能が形を変えたもの。'
      },
      '言葉': {
        essence: '思考を他者と共有するための不完全な圧縮ツール',
        detail: '頭の中の複雑な思考や感情を言葉にする時点で、必ず情報は失われる。「言葉にできない」ものこそが、本当に大切なことが多い。'
      },
      '学び': {
        essence: '昨日の自分を他人にする行為',
        detail: '本当の学びとは知識が増えることではなく、世界の見え方が変わること。学んだ後の自分は、もう元の自分には戻れない。'
      },
      '失敗': {
        essence: 'うまくいかない方法を一つ確定させた成果',
        detail: '失敗は「終わり」ではなく「データ収集」。エジソンの名言通り、うまくいかない方法を発見したことは、成功への道を一つ絞り込んだということ。'
      },
      '普通': {
        essence: '存在しない平均値を実在するかのように語る幻想',
        detail: '「普通の人」は統計上の架空の存在。全ての項目で平均的な人間は実在しない。「普通でありたい」は、存在しないものになろうとする苦行。'
      },
      '退屈': {
        essence: '脳が「今の刺激では足りない」と訴えるアラーム',
        detail: '退屈は悪いことではなく、脳が新しい挑戦や創造を求めているサイン。歴史上の多くの発明は退屈から生まれた。'
      },
      '我慢': {
        essence: '感情に支配されない技術としての自制',
        detail: '我慢は美徳とされるが、無限の我慢は自己破壊。本質的な我慢は「今耐えれば後で良くなる」という見通しがある時にだけ有効。'
      },
      '天才': {
        essence: '社会が後から貼るラベル',
        detail: '本人は夢中でやっていただけなのに、結果が出たら「天才」と呼ばれる。天才は生まれつきの属性ではなく、社会の評価。'
      },
      '大人': {
        essence: '感情のコントロール方法を覚えた子供',
        detail: '年齢で大人になるのではなく、衝動をそのまま行動に移さず、一呼吸置けるようになった時に人は大人になる。中身はみんなまだ子供。'
      },
      '常識人': {
        essence: '多数派に合わせるのが上手な人',
        detail: '常識人とは正しい人ではなく、その場の空気を読んで多数派のふるまいを選べる人。常識は正しさとは無関係。'
      },
      'おしゃれ': {
        essence: '他者の視線を意識した自己表現',
        detail: 'おしゃれの本質は服ではなく「自分をどう見せたいか」という意志。だから同じ服でも着る人によっておしゃれ度が変わる。'
      },
      'ゲーム': {
        essence: 'ルールのある安全な挑戦空間',
        detail: '現実では失敗のコストが高いが、ゲームでは何度でもやり直せる。人間が挑戦と成長を安全に体験するための仮想訓練場。'
      },
      '健康': {
        essence: '失って初めて存在に気づく日常の土台',
        detail: '健康な時は健康を意識しない。意識するのは失った時だけ。健康とは「当たり前に動ける」という、最も贅沢な当たり前。'
      },
      '推し': {
        essence: '自分の理想を他者に投影する情熱',
        detail: '推しに夢中になるのは、自分が「こうありたい」「こういうものが好き」という価値観を、その人を通して確認しているから。推し活は自己理解の旅。'
      },
      '恋': {
        essence: '脳内物質が作り出す一時的な判断力低下',
        detail: 'ドーパミン・セロトニン・オキシトシンが一気に放出され、相手を実際以上に素晴らしく感じる。恋は脳のバグであり、種の存続のための仕掛け。'
      },
      '青春': {
        essence: '失敗が許される期間限定の実験期間',
        detail: '青春の価値は「何をしたか」ではなく「取り返しのつく時期にたくさん失敗できたか」。青春を懐かしむのは、あの自由な実験期間が終わったから。'
      },
      '学校': {
        essence: '社会の縮小モデルで練習する場',
        detail: '学校で学ぶ最も重要なことは教科の知識ではなく、異なる人間と共存する方法。教室は社会のプロトタイプ。'
      },
      '会社': {
        essence: '個人ではできない規模の問題解決チーム',
        detail: '会社の存在意義は利益ではなく、一人では解決できない大きな問題に集団で取り組めること。利益はその結果。'
      },
      '面接': {
        essence: 'お互いの期待値をすり合わせる商談',
        detail: '面接は「選ばれる場」ではなく「選び合う場」。会社も候補者も、お互いが求めるものを持っているか確認している。'
      },
      '飲み会': {
        essence: 'アルコールで社会的仮面を緩める儀式',
        detail: '素面では言えないことをお酒の力で言い合う場。つまり「本音を言ってもお酒のせいにできる」という暗黙の免責契約。'
      }
    };

    // ==============================
    // カテゴリ別テンプレート（未登録語用）
    // ==============================
    const essenceTemplates = [
      {
        pattern: (w) => '表面的には「' + w + '」だが、その奥にあるのは人間の根源的な欲求',
        detail: (w) => '「' + w + '」という概念を掘り下げると、そこには必ず人間の本能的な欲求—承認・安全・つながり—のいずれかが隠れている。形を変えた欲求の表現に過ぎない。'
      },
      {
        pattern: (w) => '「' + w + '」という名前をつけて安心したいだけの曖昧な概念',
        detail: (w) => '人は理解できないものに名前をつけると安心する。「' + w + '」もまた、複雑な現象を一語に圧縮することで「わかった気」になるための便宜上のラベル。'
      },
      {
        pattern: (w) => '誰かが得をするために定義された枠組み',
        detail: (w) => '「' + w + '」の定義や価値基準を決めたのは誰か？を考えると、必ずそこに利害関係が見える。中立に見える概念ほど、誰かの意図が埋め込まれている。'
      },
      {
        pattern: (w) => '時代が変われば意味が変わる、今だけの常識',
        detail: (w) => '100年前の人に「' + w + '」を説明したら全く違う理解をされるだろう。今の意味も100年後には変わっている。本質とは「今この瞬間の多数派の解釈」。'
      },
      {
        pattern: (w) => '「' + w + '」を必要とする自分の中の欠落',
        detail: (w) => '「' + w + '」を求める時、人は自分に何かが足りないと感じている。つまり「' + w + '」の本質は、それ自体ではなく、それを求める側の心理にある。'
      },
      {
        pattern: (w) => '複雑なものを単純に見せるための便利な記号',
        detail: (w) => '「' + w + '」の一言で片付けてしまうが、実際には無数の要素が絡み合った複雑系。本質を一言で語ること自体が、本質から遠ざかる行為かもしれない。'
      },
      {
        pattern: (w) => '社会が共有する幻想の一つ',
        detail: (w) => '「' + w + '」は物理的に存在するものではなく、人々が「ある」と信じることで成立している。共同幻想が崩れた瞬間、その価値も消失する。'
      },
      {
        pattern: (w) => '人間の不安を和らげるために生まれた仕組み',
        detail: (w) => '「' + w + '」が存在する理由を辿ると、根底には人間の不安がある。未知への恐怖、孤独への恐怖、死への恐怖—それらを緩和する装置としての「' + w + '」。'
      }
    ];

    // ==============================
    // サンプルワード
    // ==============================
    const exampleWords = ['愛', 'お金', '努力', '自由', '普通', 'SNS', '才能', '人生', '推し', '失敗', 'AI', '幸せ'];

    // ==============================
    // 状態管理
    // ==============================
    let history = JSON.parse(localStorage.getItem('essenceHistory') || '[]');

    // ==============================
    // 初期化
    // ==============================
    function init() {
      renderExamples();
      renderInitialView();

      const input = document.getElementById('wordInput');
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          checkEssence();
        }
      });
    }

    function renderExamples() {
      const container = document.getElementById('examples');
      const shuffled = [...exampleWords].sort(() => Math.random() - 0.5).slice(0, 6);
      container.innerHTML = shuffled.map(w =>
        '<button class="example-chip" onclick="setWord(\'' + w + '\')">' + w + '</button>'
      ).join('');
    }

    function renderInitialView() {
      if (history.length > 0) {
        renderHistory();
      }
    }

    // ==============================
    // メイン機能
    // ==============================
    function setWord(word) {
      document.getElementById('wordInput').value = word;
      checkEssence();
    }

    function checkEssence() {
      const input = document.getElementById('wordInput');
      const word = input.value.trim();
      if (!word) return;

      const btn = document.getElementById('checkBtn');
      btn.disabled = true;

      // Show loading
      const resultArea = document.getElementById('resultArea');
      resultArea.innerHTML = '<div class="loading"><div class="loading-dots"><span></span><span></span><span></span></div><div class="loading-text">本質を解析中...</div></div>';

      // Simulate analysis time
      const delay = 800 + Math.random() * 1200;
      setTimeout(() => {
        const result = getEssence(word);
        showResult(word, result);
        saveToHistory(word, result);
        btn.disabled = false;
        input.value = '';
        input.focus();
      }, delay);
    }

    function getEssence(word) {
      // Check exact match
      if (essenceDB[word]) {
        return essenceDB[word];
      }

      // Check partial matches
      for (const key of Object.keys(essenceDB)) {
        if (word.includes(key) || key.includes(word)) {
          return {
            essence: essenceDB[key].essence,
            detail: '「' + word + '」→「' + key + '」として分析。' + essenceDB[key].detail
          };
        }
      }

      // Generate from templates
      return generateEssence(word);
    }

    function generateEssence(word) {
      // Use a hash of the word to consistently select a template
      let hash = 0;
      for (let i = 0; i < word.length; i++) {
        hash = ((hash << 5) - hash) + word.charCodeAt(i);
        hash = hash & hash;
      }
      const index = Math.abs(hash) % essenceTemplates.length;
      const template = essenceTemplates[index];

      return {
        essence: template.pattern(word),
        detail: template.detail(word)
      };
    }

    // ==============================
    // 表示
    // ==============================
    function showResult(word, result) {
      const resultArea = document.getElementById('resultArea');
      resultArea.innerHTML = `
        <div class="result-card">
          <div class="result-word">INPUT</div>
          <div class="result-input-word">${escapeHtml(word)}</div>
          <div class="result-label">ESSENCE</div>
          <div class="result-essence">${escapeHtml(result.essence)}</div>
          <div class="result-detail">${escapeHtml(result.detail)}</div>
          <div class="result-actions">
            <button class="btn-action" onclick="shareResult('${escapeAttr(word)}', '${escapeAttr(result.essence)}')">共有する</button>
            <button class="btn-action" onclick="checkAnother()">もう一度</button>
          </div>
        </div>
        ${history.length > 0 ? renderHistoryHTML() : ''}
      `;
      resultArea.scrollTop = 0;
    }

    function renderHistory() {
      const resultArea = document.getElementById('resultArea');
      const emptyState = document.getElementById('emptyState');
      if (emptyState) {
        resultArea.innerHTML = emptyState.outerHTML + renderHistoryHTML();
      }
    }

    function renderHistoryHTML() {
      if (history.length === 0) return '';
      return `
        <div class="history-section">
          <div class="history-title">
            <span>履歴</span>
            <button class="btn-clear-history" onclick="clearHistory()">クリア</button>
          </div>
          ${history.slice(0, 20).map(item => `
            <div class="history-item" onclick="setWord('${escapeAttr(item.word)}')">
              <div>
                <div class="history-item-word">${escapeHtml(item.word)}</div>
                <div class="history-item-essence">${escapeHtml(item.essence)}</div>
              </div>
              <div class="history-item-arrow">&#x203A;</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // ==============================
    // アクション
    // ==============================
    function checkAnother() {
      document.getElementById('wordInput').focus();
    }

    async function shareResult(word, essence) {
      const text = '【本質チェッカー】\n「' + word + '」の本質:\n→ ' + essence;

      if (navigator.share) {
        try {
          await navigator.share({ text: text });
        } catch (e) {
          copyToClipboard(text);
        }
      } else {
        copyToClipboard(text);
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('コピーしました！');
      }).catch(() => {
        showToast('共有できませんでした');
      });
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // ==============================
    // 履歴管理
    // ==============================
    function saveToHistory(word, result) {
      // Remove duplicate
      history = history.filter(item => item.word !== word);
      // Add to beginning
      history.unshift({ word: word, essence: result.essence });
      // Keep last 50
      history = history.slice(0, 50);
      localStorage.setItem('essenceHistory', JSON.stringify(history));
    }

    function clearHistory() {
      history = [];
      localStorage.removeItem('essenceHistory');
      showToast('履歴をクリアしました');
      const historySection = document.querySelector('.history-section');
      if (historySection) {
        historySection.remove();
      }
    }

    // ==============================
    // ユーティリティ
    // ==============================
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function escapeAttr(str) {
      return str.replace(/'/g, "\\'").replace(/"/g, '&quot;');
    }

    // ==============================
    // PWA
    // ==============================
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }

    // Initialize
    init();
  </script>
</body>
</html>
